(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{90:function(e,t,a){e.exports=a(91)},91:function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),o=a(61),i=a(52),l=a(15),c=a(20),s=a(37),m=a(0),u=a.n(m),d=a(9),p=a.n(d),f=(a(97),a(104)),h=a(105),g=a(71),b=a(106),E=a(108),v=a(109),w=a(110),y=a(74),k=a(75),O=a(116),j=a(53),C=a(46),I=a(69),x=a(102),N=a(11),S=a(80),T=a(36),P=a(78),z=a(73),B=a(112),L=a(113),R=a(103),G=a(114),W=a(115),D=a(111),J=a(35),M=a(26),A=a(107),F=a(123),U=a(122),V=a(79),q=a(117),K=a(119),_=a(118),H=a(77),Y=a(120),Z=a(62),Q="https://api.sheltonhuang.me/GoogleDriveProxy/",X=navigator.platform.toUpperCase().indexOf("MAC")>=0,$="application/vnd.google-apps.folder",ee="folderImg.jpg",te="imgNotFound.jpg",ae=Object(I.a)(function(e){return{appBar:{backgroundColor:x.a[700]},icon:{marginRight:e.spacing(2)},grow:{flexGrow:1},conditionGrow:Object(s.a)({},e.breakpoints.up("sm"),{flexGrow:1}),search:Object(s.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(N.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(N.b)(e.palette.common.white,.25)},marginRight:0,marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{width:600}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",width:"calc(100% - 50px)"},inputInput:{padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},cardGrid:{paddingTop:e.spacing(8),paddingBottom:e.spacing(8)},card:{height:"100%",display:"flex",flexDirection:"column"},cardMedia:{paddingTop:"56.25%"},cardContent:{flexGrow:1},form:{display:"flex",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120}}}),ne=function(e){var t=JSON.parse(localStorage.getItem("recentViews")||"[]"),a=t.indexOf(e);a>-1&&t.splice(a,1),t.unshift(e),t.splice(100),localStorage.setItem("recentViews",JSON.stringify(t))};function re(e){var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}var oe=function(){return localStorage.getItem("token")},ie=[];p.a.render(u.a.createElement(function(){var e=ae(),t=u.a.createRef(),a=u.a.useState({loggedIn:!!oe(),open:!1,submitting:!1}),n=Object(c.a)(a,2),s=n[0],d=n[1],p=u.a.useState(!oe()),I=Object(c.a)(p,2),x=I[0],N=I[1],le=u.a.useState([]),ce=Object(c.a)(le,2),se=ce[0],me=ce[1],ue=u.a.useState([]),de=Object(c.a)(ue,2),pe=de[0],fe=de[1],he=u.a.useState([]),ge=Object(c.a)(he,2),be=ge[0],Ee=ge[1],ve=u.a.useState([]),we=Object(c.a)(ve,2),ye=we[0],ke=we[1],Oe=u.a.useState({key:"modifiedTime",reverse:!0,disabled:!1}),je=Object(c.a)(Oe,2),Ce=je[0],Ie=je[1],xe=u.a.useState({open:!1}),Ne=Object(c.a)(xe,2),Se=Ne[0],Te=Ne[1],Pe=function(e){document.title=e.open?e.name:"GoogleDriveProxy",Te(e)},ze=function(e,t){if(Ce.disabled)return 0;if(Ce.reverse){var a=e;e=t,t=a}var n=Ce.key;return"name"===n||"modifiedTime"===n?e[n].localeCompare(t[n]):e[n]&&t[n]?parseInt(e[n])-parseInt(t[n]):e.modifiedTime.localeCompare(t.modifiedTime)},Be=function(e){return N(!0),e.rewind&&(e.value=be[be.length-2],Ee(be.slice(0,be.length-1))),fetch("".concat(Q).concat(e.value),Object(l.a)({headers:{Authorization:oe(),"Content-Type":"application/json"}},e.opts?e.opts:{})).then(function(e){return e.json()}).then(function(t){return Ie(Object(l.a)({},Ce,{disabled:!1===e.sort})),me(ie=t.files.filter(function(e){return e.mimeType!==$})),fe(t.files.filter(function(e){return e.mimeType===$})),!e.rewind&&!e.opts&&(!be.length||be[be.length-1]!==e.value)&&Ee([].concat(Object(i.a)(be),[e.value])),t}).then(function(t){return e.postProcess?e.postProcess(t):null}).catch(alert).finally(function(){window.scrollTo(0,0),N(!1)})},Le=function(e){e&&e.preventDefault&&e.preventDefault(),Be({value:t.current.value?"query/".concat(t.current.value):"folder/root"})},Re=function(e){if(e.name)Pe(e);else{var t=ie.find(function(t){return t.id===e.id});t?(Pe(Object(l.a)({},e,{name:t.name})),ne(e.id)):fetch("".concat(Q,"file"),{body:JSON.stringify({files:[e.id]}),method:"POST",headers:{Authorization:oe(),"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){1===t.files.length&&(Pe(Object(l.a)({},e,{name:t.files[0].name})),ne(e.id))}).catch(console.log)}},Ge=function(e){"Enter"===e.key&&s.username&&s.password&&We()},We=function(){d(Object(l.a)({},s,{submitting:!0})),fetch("".concat(Q,"auth"),{body:JSON.stringify({username:s.username,password:s.password}),method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){if(401===e.status)throw alert("Incorrect username or password."),e;if(200===e.status)return e.json();throw alert("Unknown response "+e.status+" from server."),e}).then(function(e){localStorage.setItem("token",e.token),De(),d({loggedIn:!0,open:!1,submitting:!1})}).catch(function(e){console.log(e),d(Object(l.a)({},s,{submitting:!1}))})},De=function(){Be({value:"folder/root"}),fetch("".concat(Q,"favorite"),{headers:{Authorization:oe()}}).then(function(e){return e.json()}).then(function(e){return ke(e.files)}).catch(alert)};Object(m.useEffect)(function(){var e=function(){return Re({open:!0,id:window.location.hash.substr(1)})};window.addEventListener("hashchange",e,!1),window.addEventListener("myhashchange",e,!1),window.location.hash.substr(1)&&Re({open:!0,id:window.location.hash.substr(1)}),oe()&&De()},[]);var Je=function(e){var t=!ye.includes(e);fetch("".concat(Q,"favorite/").concat(e),{headers:{Authorization:oe()},method:t?"PUT":"DELETE"}).then(function(){var a=Object(o.a)(r.a.mark(function a(n){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(204!==n.status){a.next=4;break}t?ye.includes(e)||ke([e].concat(Object(i.a)(ye))):ke(ye.filter(function(t){return t!==e})),a.next=11;break;case 4:if(507!==n.status){a.next=10;break}return a.next=7,n.json();case 7:throw a.sent.errorMessage;case 10:throw n.json();case 11:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()).catch(alert).finally(qe)},Me=function(e){var t,a,n,r=e.target;do{t=(r=r.parentNode).attributes.getNamedItem("data-id")?r.attributes.getNamedItem("data-id").value:null,a=r.attributes.getNamedItem("data-name")?r.attributes.getNamedItem("data-name").value:null,n=r.attributes.getNamedItem("data-mimetype")?r.attributes.getNamedItem("data-mimetype").value:null}while(r.parentNode&&!(t&&a&&n));"svg"===e.target.tagName||"path"===e.target.tagName?Je(t):n===$?Be({value:"folder/".concat(t)}):(window.history.replaceState({},"","#"+t),window.dispatchEvent(new Event("myhashchange")))},Ae=u.a.useState(null),Fe=Object(c.a)(Ae,2),Ue=Fe[0],Ve=Fe[1],qe=function(){return Ve(null)};return u.a.createElement(u.a.Fragment,null,u.a.createElement(f.a,null),u.a.createElement(h.a,{position:"sticky",className:e.appBar},u.a.createElement(g.a,null,s.loggedIn?u.a.createElement(J.a,{color:"inherit","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){return Ve(e.currentTarget)}},u.a.createElement(b.a,null)):u.a.createElement(T.a,{variant:"contained",onClick:function(){return d(Object(l.a)({},s,{open:!0}))}},"Login"),u.a.createElement(j.a,{id:"simple-menu",keepMounted:!0,anchorEl:Ue,open:Boolean(Ue),onClose:qe},u.a.createElement(M.a,{onClick:function(){return Be({value:"folder/root"})}},"Home"),u.a.createElement(M.a,{onClick:function(){return Be({value:"favorite?alt=content",postProcess:function(e){return ke(e.files.map(function(e){return e.id}))}})}},"Favorites"),u.a.createElement(M.a,{onClick:function(e){e.target.innerText&&e.target.innerText.includes("Order By")&&Ie(Object(l.a)({},Ce,{reverse:!Ce.reverse}))}},u.a.createElement("form",{className:e.form,autoComplete:"off"},u.a.createElement(A.a,{className:e.formControl},u.a.createElement(F.a,{htmlFor:"orderby"},"Order By",Ce.reverse?" \u2b07\ufe0f":" \u2b06\ufe0f"),u.a.createElement(U.a,{value:Ce.key,onChange:function(e){return Ie(Object(l.a)({},Ce,{key:e.target.value}))},inputProps:{name:"Order By",id:"orderby"}},u.a.createElement(M.a,{value:"modifiedTime"},"Last Modified"),u.a.createElement(M.a,{value:"name"},"Name"),u.a.createElement(M.a,{value:"size"},"Size"))))),u.a.createElement(M.a,{onClick:function(){var e=JSON.parse(localStorage.getItem("recentViews")||"[]");e.length&&Be({sort:!1,value:"file",opts:{body:JSON.stringify({files:e}),method:"POST"}}).then(qe)}},"Recently Viewed"),u.a.createElement(M.a,{onClick:function(){t.current.value="",d({loggedIn:!1,open:!1,submitting:!1}),me([]),fe([]),ke([]),Ee([]),N(!0),localStorage.removeItem("token"),qe()}},"Logout")),u.a.createElement("div",{className:e.grow}),u.a.createElement("div",{className:e.search},u.a.createElement("div",{className:e.searchIcon},u.a.createElement(E.a,null)),u.a.createElement("form",{action:".",onSubmit:Le},u.a.createElement(S.a,{placeholder:"Search\u2026",classes:{root:e.inputRoot,input:e.inputInput},inputProps:{"aria-label":"Search keywords"},inputRef:t,disabled:x,type:"search"}),u.a.createElement(J.a,{disabled:x,onClick:Le,color:"inherit"},u.a.createElement(v.a,null)))),u.a.createElement("div",{className:e.grow}),u.a.createElement(J.a,{color:"inherit",disabled:be.length<=1,onClick:function(){return Be({rewind:!0})}},u.a.createElement(w.a,null))),x&&s.loggedIn&&u.a.createElement(D.a,{variant:"query"})),u.a.createElement("main",null,u.a.createElement(B.a,{className:e.cardGrid,maxWidth:"lg"},u.a.createElement(z.a,{container:!0,spacing:4},pe.sort(ze).concat(se.sort(ze)).map(function(t){return u.a.createElement(z.a,{item:!0,key:t.id,xs:12,sm:6,md:3},u.a.createElement(L.a,{className:e.card,"data-id":t.id,"data-name":t.name,"data-mimetype":t.mimeType,style:{position:"relative"}},function(t){var a=t.modifiedTime,n=t.size;return a&&n?u.a.createElement(V.a,{title:u.a.createElement("div",null,re(parseInt(n)),u.a.createElement("br",null),a.substr(0,10))},u.a.createElement(Z.LazyLoadImage,{onClick:Me,src:t.mimeType===$?ee:t.thumbnailLink||te})):u.a.createElement(R.a,{className:e.cardMedia,title:t.name,onClick:Me,image:ee})}(t),t.mimeType!==$&&u.a.createElement(J.a,{size:"small",color:"primary",onClick:Me,style:{position:"absolute",top:"17px",right:"20px"}},ye.includes(t.id)?u.a.createElement(y.a,{style:{fill:"#ea062c"}}):u.a.createElement(k.a,{style:{fill:"#ea062c"}})),u.a.createElement(G.a,{className:e.cardContent},u.a.createElement(C.a,{variant:"subtitle1",component:"h2"},t.name)),u.a.createElement(W.a,null,u.a.createElement(T.a,{size:"small",color:"primary",onClick:Me},"View"),t.mimeType!==$&&u.a.createElement(V.a,{title:re(parseInt(t.size)),placement:"top"},u.a.createElement(T.a,{size:"small",color:"primary",href:"".concat(Q,"file/").concat(t.id),download:t.name,target:"_blank"},"Download")),t.mimeType!==$&&X&&u.a.createElement(T.a,{size:"small",color:"primary",href:"iina://open?url=".concat(encodeURI(Q+"file/"+t.id))},u.a.createElement("span",{role:"img","aria-label":"play in iina"},"\u25b6\ufe0fIINA")))))})))),u.a.createElement(P.a,{open:Se.open,onClose:function(){Pe({open:!1}),window.history.replaceState({},"",window.location.pathname)},"aria-labelledby":"view screen",fullWidth:!0,maxWidth:"lg"},Se.open&&u.a.createElement(g.a,null,u.a.createElement(C.a,{noWrap:!0,variant:"h6",className:e.title},Se.name),u.a.createElement("div",{className:e.grow}),u.a.createElement(J.a,{size:"small",color:"primary",onClick:function(){return Je(Se.id)},style:{marginRight:"4px"}},ye.includes(Se.id)?u.a.createElement(y.a,{style:{fill:"#ea062c"}}):u.a.createElement(k.a,{style:{fill:"#ea062c"}})),u.a.createElement(J.a,{size:"small",color:"primary",href:"".concat(Q,"file/").concat(Se.id),download:Se.name,target:"_blank"},u.a.createElement(O.a,null))),Se.open&&u.a.createElement("video",{src:"".concat(Q,"file/").concat(Se.id),controls:!0,autoPlay:!0})),u.a.createElement(P.a,{open:s.open,onClose:function(){return d(Object(l.a)({},s,{open:!1}))},"aria-labelledby":"login window",fullWidth:!0,maxWidth:"xs"},u.a.createElement(q.a,null,"Login to GoogleDriveProxy"),u.a.createElement(_.a,null,u.a.createElement(K.a,null,"To use this app, please enter your credential here."),u.a.createElement("form",{autoComplete:"off",action:"."},u.a.createElement(H.a,{autoFocus:!0,required:!0,fullWidth:!0,margin:"normal",type:"text",label:"Username",disabled:s.submitting,onKeyPress:Ge,inputProps:{autoCapitalize:"off",autoCorrect:"off"},onChange:function(e){return d(Object(l.a)({},s,{username:e.target.value}))}}),u.a.createElement(H.a,{required:!0,fullWidth:!0,margin:"normal",type:"password",label:"Password",disabled:s.submitting,onKeyPress:Ge,onChange:function(e){return d(Object(l.a)({},s,{password:e.target.value}))}}))),u.a.createElement(Y.a,null,u.a.createElement(T.a,{style:{position:"absolute",left:"10px"},onClick:function(){localStorage.setItem("token",s.password),d({loggedIn:!0,open:!1,submitting:!1}),De()},disabled:!s.password}),u.a.createElement(T.a,{disabled:!s.username||!s.password||s.submitting,onClick:We,color:"primary"},"Submit"))))},null),document.getElementById("root"))},97:function(e,t,a){}},[[90,1,2]]]);
//# sourceMappingURL=main.25a7621a.chunk.js.map