(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{90:function(e,t,a){e.exports=a(91)},91:function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),o=a(68),i=a(60),l=a(15),c=a(20),s=a(37),m=a(0),u=a.n(m),d=a(9),p=a.n(d),f=(a(97),a(104)),h=a(105),g=a(71),w=a(106),E=a(108),b=a(109),v=a(110),y=a(74),S=a(75),k=a(116),O=a(52),j=a(46),C=a(69),I=a(102),x=a(11),N=a(80),T=a(36),P=a(78),L=a(73),R=a(112),z=a(113),B=a(103),q=a(114),U=a(115),G=a(111),W=a(35),D=a(26),J=a(107),M=a(123),A=a(122),F=a(79),V=a(117),K=a(119),_=a(118),H=a(77),Y=a(120),Z=a(61),Q="https://api.sheltonhuang.me/GoogleDriveProxy/",X=navigator.platform.toUpperCase().indexOf("MAC")>=0,$="application/vnd.google-apps.folder",ee="folderImg.jpg",te="imgNotFound.jpg",ae=Object(C.a)(function(e){return{appBar:{backgroundColor:I.a[700]},icon:{marginRight:e.spacing(2)},grow:{flexGrow:1},conditionGrow:Object(s.a)({},e.breakpoints.up("sm"),{flexGrow:1}),search:Object(s.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(x.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(x.b)(e.palette.common.white,.25)},marginRight:0,marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{width:600}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",width:"calc(100% - 50px)"},inputInput:{padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},cardGrid:{paddingTop:e.spacing(8),paddingBottom:e.spacing(8)},card:{height:"100%",display:"flex",flexDirection:"column"},cardMedia:{paddingTop:"56.25%"},cardContent:{flexGrow:1},form:{display:"flex",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120}}}),ne=function(e){var t=JSON.parse(localStorage.getItem("recentViews")||"[]"),a=t.indexOf(e);a>-1&&t.splice(a,1),t.unshift(e),t.splice(100),localStorage.setItem("recentViews",JSON.stringify(t))};function re(e){var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}var oe=function(){return localStorage.getItem("token")},ie=[];p.a.render(u.a.createElement(function(){var e=ae(),t=u.a.createRef(),a=u.a.useState({loggedIn:!!oe(),open:!1,submitting:!1}),n=Object(c.a)(a,2),s=n[0],d=n[1],p=u.a.useState(!oe()),C=Object(c.a)(p,2),I=C[0],x=C[1],le=u.a.useState([]),ce=Object(c.a)(le,2),se=ce[0],me=ce[1],ue=u.a.useState([]),de=Object(c.a)(ue,2),pe=de[0],fe=de[1],he=u.a.useState(["folder/root"]),ge=Object(c.a)(he,2),we=ge[0],Ee=ge[1],be=u.a.useState([]),ve=Object(c.a)(be,2),ye=ve[0],Se=ve[1],ke=u.a.useState({key:"modifiedTime",reverse:!0,disabled:!1}),Oe=Object(c.a)(ke,2),je=Oe[0],Ce=Oe[1],Ie=u.a.useState({open:!1}),xe=Object(c.a)(Ie,2),Ne=xe[0],Te=xe[1],Pe=function(e){document.title=e.open?e.name:"GoogleDriveProxy",Te(e)},Le=new URLSearchParams,Re=function(e){var t=new URLSearchParams(window.location.hash.substr(1)),a=t.get("q"),n=t.get("f"),r=new URLSearchParams;r.set("q",a||"folder/root"),n&&r.set("f",n),Le.get("q")!=r.get("q")&&(e&&"rewind"!=e.type&&we.push(r.get("q")),Be({value:r.get("q")})),n?Ue({open:!0,id:n}):Pe({open:!1}),window.history.replaceState({},"","#"+r.toString()),Le=r},ze=function(e,t){if(je.disabled)return 0;if(je.reverse){var a=e;e=t,t=a}var n=je.key;return"name"===n||"modifiedTime"===n?e[n].localeCompare(t[n]):e[n]&&t[n]?parseInt(e[n])-parseInt(t[n]):e.modifiedTime.localeCompare(t.modifiedTime)},Be=function(e){return x(!0),fetch("".concat(Q).concat(e.value),Object(l.a)({headers:{Authorization:oe(),"Content-Type":"application/json"}},e.opts?e.opts:{})).then(function(e){return e.json()}).then(function(t){return Ce(Object(l.a)({},je,{disabled:!1===e.sort})),me(ie=t.files.filter(function(e){return e.mimeType!==$})),fe(t.files.filter(function(e){return e.mimeType===$})),t}).then(function(t){return e.postProcess?e.postProcess(t):null}).catch(alert).finally(function(){window.scrollTo(0,0),x(!1)})},qe=function(e){e&&e.preventDefault&&e.preventDefault();var a=new URLSearchParams(window.location.hash.substr(1));a.set("q",t.current.value?"query/".concat(t.current.value):"folder/root"),window.history.replaceState({},"","#"+a.toString()),window.dispatchEvent(new Event("myhashchange"))},Ue=function(e){if(e.name)Pe(e);else{var t=ie.find(function(t){return t.id===e.id});t?(Pe(Object(l.a)({},e,{name:t.name})),ne(e.id)):fetch("".concat(Q,"file"),{body:JSON.stringify({files:[e.id]}),method:"POST",headers:{Authorization:oe(),"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){1===t.files.length&&(Pe(Object(l.a)({},e,{name:t.files[0].name})),ne(e.id))}).catch(console.log)}},Ge=function(e){"Enter"===e.key&&s.username&&s.password&&We()},We=function(){d(Object(l.a)({},s,{submitting:!0})),fetch("".concat(Q,"auth"),{body:JSON.stringify({username:s.username,password:s.password}),method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){if(401===e.status)throw alert("Incorrect username or password."),e;if(200===e.status)return e.json();throw alert("Unknown response "+e.status+" from server."),e}).then(function(e){localStorage.setItem("token",e.token),De(),d({loggedIn:!0,open:!1,submitting:!1})}).catch(function(e){console.log(e),d(Object(l.a)({},s,{submitting:!1}))})},De=function(){Re(),fetch("".concat(Q,"favorite"),{headers:{Authorization:oe()}}).then(function(e){return e.json()}).then(function(e){return Se(e.files)}).catch(alert)};Object(m.useEffect)(function(){window.addEventListener("hashchange",Re,!1),window.addEventListener("myhashchange",Re,!1),window.addEventListener("rewind",Re,!1),oe()&&De()},[]);var Je=function(e){var t=!ye.includes(e);fetch("".concat(Q,"favorite/").concat(e),{headers:{Authorization:oe()},method:t?"PUT":"DELETE"}).then(function(){var a=Object(i.a)(r.a.mark(function a(n){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(204!==n.status){a.next=4;break}t?ye.includes(e)||Se([e].concat(Object(o.a)(ye))):Se(ye.filter(function(t){return t!==e})),a.next=11;break;case 4:if(507!==n.status){a.next=10;break}return a.next=7,n.json();case 7:throw a.sent.errorMessage;case 10:throw n.json();case 11:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()).catch(alert).finally(_e)},Me=function(e){var t,a,n,r=e.target;do{t=(r=r.parentNode).attributes.getNamedItem("data-id")?r.attributes.getNamedItem("data-id").value:null,a=r.attributes.getNamedItem("data-name")?r.attributes.getNamedItem("data-name").value:null,n=r.attributes.getNamedItem("data-mimetype")?r.attributes.getNamedItem("data-mimetype").value:null}while(r.parentNode&&!(t&&a&&n));if("svg"===e.target.tagName||"path"===e.target.tagName)Je(t);else{var o=new URLSearchParams(window.location.hash.substr(1));n===$?(o.set("q","folder/".concat(t)),window.history.replaceState({},"","#"+o.toString()),window.dispatchEvent(new Event("myhashchange"))):(o.set("f",t),window.history.replaceState({},"","#"+o.toString()),window.dispatchEvent(new Event("myhashchange")))}},Ae=u.a.useState(null),Fe=Object(c.a)(Ae,2),Ve=Fe[0],Ke=Fe[1],_e=function(){return Ke(null)};return u.a.createElement(u.a.Fragment,null,u.a.createElement(f.a,null),u.a.createElement(h.a,{position:"sticky",className:e.appBar},u.a.createElement(g.a,null,s.loggedIn?u.a.createElement(W.a,{color:"inherit","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){return Ke(e.currentTarget)}},u.a.createElement(w.a,null)):u.a.createElement(T.a,{variant:"contained",onClick:function(){return d(Object(l.a)({},s,{open:!0}))}},"Login"),u.a.createElement(O.a,{id:"simple-menu",keepMounted:!0,anchorEl:Ve,open:Boolean(Ve),onClose:_e},u.a.createElement(D.a,{onClick:function(){window.history.replaceState({},"","#"),window.dispatchEvent(new Event("myhashchange"))}},"Home"),u.a.createElement(D.a,{onClick:function(){return Be({value:"favorite?alt=content",postProcess:function(e){return Se(e.files.map(function(e){return e.id}))}})}},"Favorites"),u.a.createElement(D.a,{onClick:function(e){e.target.innerText&&e.target.innerText.includes("Order By")&&Ce(Object(l.a)({},je,{reverse:!je.reverse}))}},u.a.createElement("form",{className:e.form,autoComplete:"off"},u.a.createElement(J.a,{className:e.formControl},u.a.createElement(M.a,{htmlFor:"orderby"},"Order By",je.reverse?" \u2b07\ufe0f":" \u2b06\ufe0f"),u.a.createElement(A.a,{value:je.key,onChange:function(e){return Ce(Object(l.a)({},je,{key:e.target.value}))},inputProps:{name:"Order By",id:"orderby"}},u.a.createElement(D.a,{value:"modifiedTime"},"Last Modified"),u.a.createElement(D.a,{value:"name"},"Name"),u.a.createElement(D.a,{value:"size"},"Size"))))),u.a.createElement(D.a,{onClick:function(){var e=JSON.parse(localStorage.getItem("recentViews")||"[]");e.length&&Be({sort:!1,value:"file",opts:{body:JSON.stringify({files:e}),method:"POST"}}).then(_e)}},"Recently Viewed"),u.a.createElement(D.a,{onClick:function(){t.current.value="",d({loggedIn:!1,open:!1,submitting:!1}),me([]),fe([]),Se([]),Ee([]),x(!0),localStorage.removeItem("token"),_e()}},"Logout")),u.a.createElement("div",{className:e.grow}),u.a.createElement("div",{className:e.search},u.a.createElement("div",{className:e.searchIcon},u.a.createElement(E.a,null)),u.a.createElement("form",{action:".",onSubmit:qe},u.a.createElement(N.a,{placeholder:"Search\u2026",classes:{root:e.inputRoot,input:e.inputInput},inputProps:{"aria-label":"Search keywords"},inputRef:t,disabled:I,type:"search"}),u.a.createElement(W.a,{disabled:I,onClick:qe,color:"inherit"},u.a.createElement(b.a,null)))),u.a.createElement("div",{className:e.grow}),u.a.createElement(W.a,{color:"inherit",disabled:we.length<=1,onClick:function(){var e=new URLSearchParams(window.location.hash.substr(1));we.pop(),e.set("q",we.pop()),window.history.replaceState({},"","#"+e.toString()),window.dispatchEvent(new Event("rewind"))}},u.a.createElement(v.a,null))),I&&s.loggedIn&&u.a.createElement(G.a,{variant:"query"})),u.a.createElement("main",null,u.a.createElement(R.a,{className:e.cardGrid,maxWidth:"lg"},u.a.createElement(L.a,{container:!0,spacing:4},pe.sort(ze).concat(se.sort(ze)).map(function(t){return u.a.createElement(L.a,{item:!0,key:t.id,xs:12,sm:6,md:3},u.a.createElement(z.a,{className:e.card,"data-id":t.id,"data-name":t.name,"data-mimetype":t.mimeType,style:{position:"relative"}},function(t){var a=t.modifiedTime,n=t.size;return a&&n?u.a.createElement(F.a,{title:u.a.createElement("div",null,re(parseInt(n)),u.a.createElement("br",null),a.substr(0,10))},u.a.createElement(Z.LazyLoadImage,{onClick:Me,src:t.mimeType===$?ee:t.thumbnailLink||te})):u.a.createElement(B.a,{className:e.cardMedia,title:t.name,onClick:Me,image:ee})}(t),t.mimeType!==$&&u.a.createElement(W.a,{size:"small",color:"primary",onClick:Me,style:{position:"absolute",top:"17px",right:"20px"}},ye.includes(t.id)?u.a.createElement(y.a,{style:{fill:"#ea062c"}}):u.a.createElement(S.a,{style:{fill:"#ea062c"}})),u.a.createElement(q.a,{className:e.cardContent},u.a.createElement(j.a,{variant:"subtitle2",component:"h2"},t.name)),u.a.createElement(U.a,null,u.a.createElement(T.a,{size:"small",color:"primary",onClick:Me},"View"),t.mimeType!==$&&u.a.createElement(F.a,{title:re(parseInt(t.size)),placement:"top"},u.a.createElement(T.a,{size:"small",color:"primary",href:"".concat(Q,"file/").concat(t.id),download:t.name,target:"_blank"},"Download")),t.mimeType!==$&&X&&u.a.createElement(T.a,{size:"small",color:"primary",href:"iina://open?url=".concat(encodeURI(Q+"file/"+t.id))},u.a.createElement("span",{role:"img","aria-label":"play in iina"},"\u25b6\ufe0fIINA")))))})))),u.a.createElement(P.a,{open:Ne.open,onClose:function(){var e=new URLSearchParams(window.location.hash.substr(1));e.delete("f"),window.history.replaceState({},"","#"+e.toString()),window.dispatchEvent(new Event("myhashchange"))},"aria-labelledby":"view screen",fullWidth:!0,maxWidth:"lg"},Ne.open&&u.a.createElement(g.a,null,u.a.createElement(j.a,{noWrap:!0,variant:"h6",className:e.title},Ne.name),u.a.createElement("div",{className:e.grow}),u.a.createElement(W.a,{size:"small",color:"primary",onClick:function(){return Je(Ne.id)},style:{marginRight:"4px"}},ye.includes(Ne.id)?u.a.createElement(y.a,{style:{fill:"#ea062c"}}):u.a.createElement(S.a,{style:{fill:"#ea062c"}})),u.a.createElement(W.a,{size:"small",color:"primary",href:"".concat(Q,"file/").concat(Ne.id),download:Ne.name,target:"_blank"},u.a.createElement(k.a,null))),Ne.open&&u.a.createElement("video",{src:"".concat(Q,"file/").concat(Ne.id),controls:!0,autoPlay:!0})),u.a.createElement(P.a,{open:s.open,onClose:function(){return d(Object(l.a)({},s,{open:!1}))},"aria-labelledby":"login window",fullWidth:!0,maxWidth:"xs"},u.a.createElement(V.a,null,"Login to GoogleDriveProxy"),u.a.createElement(_.a,null,u.a.createElement(K.a,null,"To use this app, please enter your credential here."),u.a.createElement("form",{autoComplete:"off",action:"."},u.a.createElement(H.a,{autoFocus:!0,required:!0,fullWidth:!0,margin:"normal",type:"text",label:"Username",disabled:s.submitting,onKeyPress:Ge,inputProps:{autoCapitalize:"off",autoCorrect:"off"},onChange:function(e){return d(Object(l.a)({},s,{username:e.target.value}))}}),u.a.createElement(H.a,{required:!0,fullWidth:!0,margin:"normal",type:"password",label:"Password",disabled:s.submitting,onKeyPress:Ge,onChange:function(e){return d(Object(l.a)({},s,{password:e.target.value}))}}))),u.a.createElement(Y.a,null,u.a.createElement(T.a,{style:{position:"absolute",left:"10px"},onClick:function(){localStorage.setItem("token",s.password),d({loggedIn:!0,open:!1,submitting:!1}),De()},disabled:!s.password}),u.a.createElement(T.a,{disabled:!s.username||!s.password||s.submitting,onClick:We,color:"primary"},"Submit"))))},null),document.getElementById("root"))},97:function(e,t,a){}},[[90,1,2]]]);
//# sourceMappingURL=main.00eab4ad.chunk.js.map