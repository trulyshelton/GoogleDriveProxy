(this.webpackJsonpgdp=this.webpackJsonpgdp||[]).push([[0],{100:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var a=n(59),r=n.n(a),i=n(67),o=n(13),c=n(21),s=n(60),l=n(42),d=n(0),u=n.n(d),h=n(11),p=n.n(h),j=(n(100),n(109)),m=n(110),b=n(77),f=n(111),g=n(113),O=n(114),w=n(115),x=n(79),y=n(80),v=n(121),S=n(61),k=n(55),C=n(106),I=n(107),N=n(12),E=n(62),P=n(40),T=n(82),B=n(78),L=n(117),R=n(118),q=n(108),z=n(119),U=n(120),J=n(116),G=n(39),W=n(28),D=n(112),M=n(129),A=n(127),F=n(128),V=n(122),K=n(124),_=n(123),H=n(83),Y=n(125),Z=n(68),Q=n(5),X="https://api.sheltonhuang.me/GoogleDriveProxy/",$=navigator.platform.toUpperCase().indexOf("MAC")>=0,ee="application/vnd.google-apps.folder",te="folderImg.jpg",ne=Object(C.a)((function(e){return{appBar:{backgroundColor:I.a[700]},icon:{marginRight:e.spacing(2)},grow:{flexGrow:1},conditionGrow:Object(l.a)({},e.breakpoints.up("sm"),{flexGrow:1}),search:Object(l.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(N.b)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(N.b)(e.palette.common.white,.25)},marginRight:0,marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{width:600}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",width:"calc(100% - 50px)"},inputInput:{padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},cardGrid:{paddingTop:e.spacing(8),paddingBottom:e.spacing(8)},card:{height:"100%",display:"flex",flexDirection:"column"},cardMedia:{paddingTop:"56.25%"},cardContent:{flexGrow:1},form:{display:"flex",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120}}})),ae=function(){return JSON.parse(localStorage.getItem("orderBy")||'{"key":"createdTime","order":" desc"}')},re=function(e){var t=JSON.parse(localStorage.getItem("recentViews")||"[]"),n=t.indexOf(e);n>-1&&t.splice(n,1),t.unshift(e),t.splice(100),localStorage.setItem("recentViews",JSON.stringify(t))},ie=function(){return JSON.parse(localStorage.getItem("history")||'["folder/root"]')};function oe(e){var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}var ce=function(){return localStorage.getItem("token")},se=[];function le(){var e=ne(),t=u.a.createRef(),n=ie(),a=u.a.useState({loggedIn:!!ce(),open:!1,submitting:!1}),l=Object(c.a)(a,2),h=l[0],p=l[1],C=u.a.useState(!ce()),I=Object(c.a)(C,2),N=I[0],le=I[1],de=u.a.useState([]),ue=Object(c.a)(de,2),he=ue[0],pe=ue[1],je=u.a.useState([]),me=Object(c.a)(je,2),be=me[0],fe=me[1],ge=u.a.useState(n),Oe=Object(c.a)(ge,2),we=Oe[0],xe=Oe[1],ye=u.a.useState([]),ve=Object(c.a)(ye,2),Se=ve[0],ke=ve[1],Ce=u.a.useState(ae()),Ie=Object(c.a)(Ce,2),Ne=Ie[0],Ee=Ie[1],Pe=u.a.useState({open:!1}),Te=Object(c.a)(Pe,2),Be=Te[0],Le=Te[1],Re=function(e){document.title=e.open?e.name:"GoogleDriveProxy",Le(e)},qe=new URLSearchParams;n.length>1&&qe.set("q",n[n.length-1]);var ze=function(e){var t=new URLSearchParams(window.location.hash.substr(1)),n=t.get("q"),a=t.get("f"),r=new URLSearchParams;r.set("q",n||"folder/root"),a&&r.set("f",a);var i,o=ae(),c=new URLSearchParams({orderBy:o.key+o.order}).toString();qe.get("q")!==r.get("q")?(e&&"rewind"!==e.type&&(we.push(qe.get("q")),i=qe.get("q"),localStorage.setItem("history",JSON.stringify([].concat(Object(s.a)(ie()),[i])))),Ue({value:r.get("q")+"?"+c})):e&&e.force&&Ue({value:r.get("q")+"?"+c}),a?Ge({open:!0,id:a}):Re({open:!1}),window.history.replaceState({},"","#"+r.toString()),qe=r},Ue=function(e){return le(!0),fetch("".concat(X).concat(e.value),Object(o.a)({headers:{Authorization:ce(),"Content-Type":"application/json"}},e.opts?e.opts:{})).then((function(e){return e.json()})).then((function(e){return pe(se=e.files.filter((function(e){return e.mimeType!==ee}))),fe(e.files.filter((function(e){return e.mimeType===ee}))),e})).then((function(t){return e.postProcess?e.postProcess(t):null})).catch(alert).finally((function(){window.scrollTo(0,0),le(!1)}))},Je=function(e){e&&e.preventDefault&&e.preventDefault();var n=new URLSearchParams(window.location.hash.substr(1));n.set("q",t.current.value?"query/".concat(t.current.value):"folder/root"),window.history.replaceState({},"","#"+n.toString()),window.dispatchEvent(new Event("myhashchange"))},Ge=function(e){if(e.name)Re(e);else{var t=se.find((function(t){return t.id===e.id}));t?(Re(Object(o.a)(Object(o.a)({},e),{},{name:t.name})),re(e.id)):fetch("".concat(X,"file"),{body:JSON.stringify({files:[e.id]}),method:"POST",headers:{Authorization:ce(),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){1===t.files.length&&(Re(Object(o.a)(Object(o.a)({},e),{},{name:t.files[0].name})),re(e.id))})).catch(console.log)}},We=function(e){"Enter"===e.key&&h.username&&h.password&&De()},De=function(){p(Object(o.a)(Object(o.a)({},h),{},{submitting:!0})),fetch("".concat(X,"auth"),{body:JSON.stringify({username:h.username,password:h.password}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){if(401===e.status)throw alert("Incorrect username or password."),e;if(200===e.status)return e.json();throw alert("Unknown response "+e.status+" from server."),e})).then((function(e){localStorage.setItem("token",e.token),Me(),p({loggedIn:!0,open:!1,submitting:!1})})).catch((function(e){console.log(e),p(Object(o.a)(Object(o.a)({},h),{},{submitting:!1}))}))},Me=function(){ze(),fetch("".concat(X,"favorite"),{headers:{Authorization:ce()}}).then((function(e){return e.json()})).then((function(e){return ke(e.files)})).catch(alert)};Object(d.useEffect)((function(){window.addEventListener("hashchange",ze,!1),window.addEventListener("myhashchange",ze,!1),window.addEventListener("rewind",ze,!1),ce()&&Me()}),[]);var Ae=function(e){var t=!Se.includes(e);fetch("".concat(X,"favorite/").concat(e),{headers:{Authorization:ce()},method:t?"PUT":"DELETE"}).then(function(){var n=Object(i.a)(r.a.mark((function n(a){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(204!==a.status){n.next=4;break}t?Se.includes(e)||ke([e].concat(Object(s.a)(Se))):ke(Se.filter((function(t){return t!==e}))),n.next=11;break;case 4:if(507!==a.status){n.next=10;break}return n.next=7,a.json();case 7:throw n.sent.errorMessage;case 10:throw a.json();case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch(alert).finally(Ye)};Object(d.useEffect)((function(){var e;e=Ne,localStorage.setItem("orderBy",JSON.stringify(e));var t=new Event("myhashchange");t.force=!0,window.dispatchEvent(t)}),[Ne]);var Fe=function(e){var t,n,a,r=e.target;do{t=(r=r.parentNode).attributes.getNamedItem("data-id")?r.attributes.getNamedItem("data-id").value:null,n=r.attributes.getNamedItem("data-name")?r.attributes.getNamedItem("data-name").value:null,a=r.attributes.getNamedItem("data-mimetype")?r.attributes.getNamedItem("data-mimetype").value:null}while(r.parentNode&&!(t&&n&&a));if("svg"===e.target.tagName||"path"===e.target.tagName)Ae(t);else{var i=new URLSearchParams(window.location.hash.substr(1));a===ee?(i.set("q","folder/".concat(t)),window.history.replaceState({},"","#"+i.toString()),window.dispatchEvent(new Event("myhashchange"))):(i.set("f",t),window.history.replaceState({},"","#"+i.toString()),window.dispatchEvent(new Event("myhashchange")))}},Ve=u.a.useState(null),Ke=Object(c.a)(Ve,2),_e=Ke[0],He=Ke[1],Ye=function(){return He(null)};function Ze(t){return t.size?Object(Q.jsx)(Z.LazyLoadImage,{onClick:Fe,once:!0,offset:600,style:{cursor:"pointer"},src:t.mimeType===ee?te:t.thumbnailLink||"imgNotFound.jpg"}):Object(Q.jsx)(q.a,{className:e.cardMedia,title:t.name,onClick:Fe,image:te})}return Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsx)(j.a,{}),Object(Q.jsxs)(m.a,{position:"sticky",className:e.appBar,children:[Object(Q.jsxs)(b.a,{children:[h.loggedIn?Object(Q.jsx)(G.a,{color:"inherit","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){return He(e.currentTarget)},children:Object(Q.jsx)(f.a,{})}):Object(Q.jsx)(P.a,{variant:"contained",onClick:function(){return p(Object(o.a)(Object(o.a)({},h),{},{open:!0}))},children:"Login"}),Object(Q.jsxs)(S.a,{id:"simple-menu",keepMounted:!0,anchorEl:_e,open:Boolean(_e),onClose:Ye,children:[Object(Q.jsx)(W.a,{onClick:function(){window.history.replaceState({},"","#"),window.dispatchEvent(new Event("myhashchange"))},children:"Home"}),Object(Q.jsx)(W.a,{onClick:function(){return Ue({value:"favorite?alt=content",postProcess:function(e){return ke(e.files.map((function(e){return e.id})))}})},children:"Favorites"}),Object(Q.jsx)(W.a,{onClick:function(e){e.target.innerText&&e.target.innerText.includes("Order By")&&Ee(Object(o.a)(Object(o.a)({},Ne),{},{order:Ne.order.length?"":" desc"}))},children:Object(Q.jsx)("form",{className:e.form,autoComplete:"off",children:Object(Q.jsxs)(D.a,{className:e.formControl,children:[Object(Q.jsxs)(M.a,{htmlFor:"orderby",children:["Order By",Ne.order.length?" \u2b07\ufe0f":" \u2b06\ufe0f"]}),Object(Q.jsxs)(A.a,{value:Ne.key,onChange:function(e){return Ee(Object(o.a)(Object(o.a)({},Ne),{},{key:e.target.value}))},inputProps:{name:"Order By",id:"orderby"},children:[Object(Q.jsx)(W.a,{value:"createdTime",children:"Create Time"}),Object(Q.jsx)(W.a,{value:"name",children:"Name"}),Object(Q.jsx)(W.a,{value:"quotaBytesUsed",children:"Size"})]})]})})}),Object(Q.jsx)(W.a,{onClick:function(){var e=JSON.parse(localStorage.getItem("recentViews")||"[]");e.length&&Ue({value:"file",opts:{body:JSON.stringify({files:e}),method:"POST"}}).then(Ye)},children:"Recently Viewed"}),Object(Q.jsx)(W.a,{onClick:function(){t.current.value="",p({loggedIn:!1,open:!1,submitting:!1}),pe([]),fe([]),ke([]),xe([]),le(!0),localStorage.removeItem("token"),localStorage.removeItem("history"),Ye()},children:"Logout"})]}),Object(Q.jsx)("div",{className:e.grow}),Object(Q.jsxs)("div",{className:e.search,children:[Object(Q.jsx)("div",{className:e.searchIcon,children:Object(Q.jsx)(g.a,{})}),Object(Q.jsxs)("form",{action:".",onSubmit:Je,children:[Object(Q.jsx)(E.a,{placeholder:"Search\u2026",classes:{root:e.inputRoot,input:e.inputInput},inputProps:{"aria-label":"Search keywords"},inputRef:t,disabled:N,type:"search"}),Object(Q.jsx)(G.a,{disabled:N,onClick:Je,color:"inherit",children:Object(Q.jsx)(O.a,{})})]})]}),Object(Q.jsx)("div",{className:e.grow}),Object(Q.jsx)(G.a,{color:"inherit",disabled:we.length<1,onClick:function(){var e=new URLSearchParams(window.location.hash.substr(1));e.set("q",we.pop()),function(){var e=ie();if(e.length<1)return null;var t=e.pop();localStorage.setItem("history",JSON.stringify(e))}(),window.history.replaceState({},"","#"+e.toString()),window.dispatchEvent(new Event("rewind"))},children:Object(Q.jsx)(w.a,{})})]}),N&&h.loggedIn&&Object(Q.jsx)(J.a,{variant:"query"})]}),Object(Q.jsx)("main",{children:Object(Q.jsx)(L.a,{className:e.cardGrid,maxWidth:"lg",children:Object(Q.jsx)(B.a,{container:!0,spacing:4,children:be.concat(he).map((function(t){return Object(Q.jsx)(B.a,{item:!0,xs:12,sm:6,md:3,children:Object(Q.jsxs)(R.a,{className:e.card,"data-id":t.id,"data-name":t.name,"data-mimetype":t.mimeType,style:{position:"relative"},children:[Ze(t),t.mimeType!==ee&&Object(Q.jsx)(G.a,{size:"small",color:"primary",onClick:Fe,style:{position:"absolute",top:"17px",right:"20px"},children:Se.includes(t.id)?Object(Q.jsx)(x.a,{style:{fill:"#ea062c"}}):Object(Q.jsx)(y.a,{style:{fill:"#ea062c"}})}),Object(Q.jsx)(z.a,{className:e.cardContent,children:Object(Q.jsx)(k.a,{variant:"subtitle2",children:t.name})}),Object(Q.jsxs)(U.a,{children:[Object(Q.jsx)(P.a,{size:"small",color:"primary",onClick:Fe,children:"View"}),t.mimeType!==ee&&Object(Q.jsx)(F.a,{title:oe(parseInt(t.size)),placement:"top",children:Object(Q.jsx)(P.a,{size:"small",color:"primary",href:"".concat(X,"file/").concat(t.id),download:t.name,target:"_blank",children:"Download"})}),t.mimeType!==ee&&$&&Object(Q.jsx)(P.a,{size:"small",color:"primary",href:"iina://open?url=".concat(encodeURI(X+"file/"+t.id)),children:Object(Q.jsx)("span",{role:"img","aria-label":"play in iina",children:"\u25b6\ufe0fIINA"})})]})]})},t.id)}))})})}),Object(Q.jsxs)(T.a,{open:Be.open,onClose:function(){var e=new URLSearchParams(window.location.hash.substr(1));e.delete("f"),window.history.replaceState({},"","#"+e.toString()),window.dispatchEvent(new Event("myhashchange"))},"aria-labelledby":"view screen",fullWidth:!0,maxWidth:"lg",children:[Be.open&&Object(Q.jsxs)(b.a,{children:[Object(Q.jsx)(k.a,{noWrap:!0,variant:"h6",className:e.title,children:Be.name}),Object(Q.jsx)("div",{className:e.grow}),Object(Q.jsx)(G.a,{size:"small",color:"primary",onClick:function(){return Ae(Be.id)},style:{marginRight:"4px"},children:Se.includes(Be.id)?Object(Q.jsx)(x.a,{style:{fill:"#ea062c"}}):Object(Q.jsx)(y.a,{style:{fill:"#ea062c"}})}),Object(Q.jsx)(G.a,{size:"small",color:"primary",href:"".concat(X,"file/").concat(Be.id),download:Be.name,target:"_blank",children:Object(Q.jsx)(v.a,{})})]}),Be.open&&Object(Q.jsx)("video",{src:"".concat(X,"file/").concat(Be.id),controls:!0,autoPlay:!0})]}),Object(Q.jsxs)(T.a,{open:h.open,onClose:function(){return p(Object(o.a)(Object(o.a)({},h),{},{open:!1}))},"aria-labelledby":"login window",fullWidth:!0,maxWidth:"xs",children:[Object(Q.jsx)(V.a,{children:"Login to GoogleDriveProxy"}),Object(Q.jsxs)(_.a,{children:[Object(Q.jsx)(K.a,{children:"To use this app, please enter your credential here."}),Object(Q.jsxs)("form",{autoComplete:"off",action:".",children:[Object(Q.jsx)(H.a,{autoFocus:!0,required:!0,fullWidth:!0,margin:"normal",type:"text",label:"Username",disabled:h.submitting,onKeyPress:We,inputProps:{autoCapitalize:"off",autoCorrect:"off"},onChange:function(e){return p(Object(o.a)(Object(o.a)({},h),{},{username:e.target.value}))}}),Object(Q.jsx)(H.a,{required:!0,fullWidth:!0,margin:"normal",type:"password",label:"Password",disabled:h.submitting,onKeyPress:We,onChange:function(e){return p(Object(o.a)(Object(o.a)({},h),{},{password:e.target.value}))}})]})]}),Object(Q.jsxs)(Y.a,{children:[Object(Q.jsx)(P.a,{style:{position:"absolute",left:"10px"},onClick:function(){localStorage.setItem("token",h.password),p({loggedIn:!0,open:!1,submitting:!1}),Me()},disabled:!h.password}),Object(Q.jsx)(P.a,{disabled:!h.username||!h.password||h.submitting,onClick:De,color:"primary",children:"Submit"})]})]})]})}p.a.render(Object(Q.jsx)(le,{}),document.getElementById("root"))}},[[84,1,2]]]);
//# sourceMappingURL=main.758f2a57.chunk.js.map